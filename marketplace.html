<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tamagotchi Pixel ‚Äî Marketplace</title>
<style>
body{background:#071726;color:#fff;font-family:sans-serif;text-align:center;}
.market-list{max-width:400px;margin:10px auto;text-align:left;}
.item{background:#0f1724;margin-bottom:8px;padding:8px;border-radius:6px;}
.btn{background:#10b981;color:#042018;padding:6px;margin:3px;border:0;border-radius:6px;cursor:pointer;}
.link-nav{margin-top:10px;}
a{color:#10b981;text-decoration:none;font-weight:bold;}
</style>
</head>
<body>
<h1>üõí Marketplace</h1>
<div id="market" class="market-list"></div>
<div class="link-nav">
  <a href="index.html">üè† Game</a> | 
  <a href="inventory.html">üì¶ Inventory</a>
</div>
<script>
const PLAYER_KEY = 'tama_player_v3';
const MARKET_KEY = 'tama_market_v3';
function loadPlayer(){ return JSON.parse(localStorage.getItem(PLAYER_KEY)) || null; }
function savePlayer(obj){ localStorage.setItem(PLAYER_KEY, JSON.stringify(obj)); }
function loadMarket(){ return JSON.parse(localStorage.getItem(MARKET_KEY)) || {}; }
function saveMarket(obj){ localStorage.setItem(MARKET_KEY, JSON.stringify(obj)); }

let player = loadPlayer();
let market = loadMarket();

const listDiv = document.getElementById('market');

function renderMarket(){
  listDiv.innerHTML = '';
  const keys = Object.keys(market);
  if(keys.length===0){ listDiv.innerHTML='<div>Marketplace kosong</div>'; return;}
  keys.forEach(k=>{
    const item = market[k];
    const div = document.createElement('div');
    div.className='item';
    let offersHtml = '';
    if(item.offers && item.offers.length>0){
      offersHtml = '<div><strong>Tawaran:</strong><br>';
      item.offers.forEach((o,i)=>{
        offersHtml += `${o.buyer}: ${o.price} <button onclick="acceptOffer('${k}',${i})">Terima</button><button onclick="rejectOffer('${k}',${i})">Tolak</button><br>`;
      });
      offersHtml += '</div>';
    }
    div.innerHTML = `
      <div><strong>${item.pet.name}</strong> | Harga: ${item.price}</div>
      <button class="btn" onclick="buyPet('${k}')">Beli</button>
      <button class="btn" onclick="offer('${k}')">Tawar</button>
      ${offersHtml}
    `;
    listDiv.appendChild(div);
  });
}

function buyPet(id){
  const sale = market[id];
  if(player.coins < sale.price) return alert('Coin tidak cukup!');
  player.coins -= sale.price;
  if(!player.inventory) player.inventory=[];
  player.inventory.push(sale.pet);
  delete market[id];
  savePlayer(player);
  saveMarket(market);
  alert('Pet dibeli!');
  renderMarket();
}

function offer(id){
  const price = prompt('Masukkan harga tawar:');
  if(!price) return;
  const offerObj = {buyer:player.name||'Player',price:parseInt(price)};
  market[id].offers.push(offerObj);
  saveMarket(market);
  renderMarket();
}

function acceptOffer(id,i){
  const offer = market[id].offers[i];
  alert('Tawaran diterima: '+offer.buyer+' ('+offer.price+')');
  delete market[id];
  saveMarket(market);
  renderMarket();
}

function rejectOffer(id,i){
  market[id].offers.splice(i,1);
  saveMarket(market);
  renderMarket();
}

renderMarket();
</script>
</body>
</html>
