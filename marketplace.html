<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marketplace</title>
<style>
body{background:#08121a;color:#fff;font-family:sans-serif;padding:10px}
.item{background:#111;margin:8px;padding:8px;border-radius:6px}
button{margin:4px;padding:6px 10px}
</style>
</head>
<body>
<h2>üè™ Marketplace</h2>
<div id="marketList"></div>
<a href="index.html"><button>Kembali ke Game</button></a>
<script>
let player=JSON.parse(localStorage.getItem('player')||'null');
let market=JSON.parse(localStorage.getItem('market')||'{}');
const list=document.getElementById('marketList');

function render(){
  list.innerHTML='';
  Object.values(market).forEach(item=>{
    const div=document.createElement('div');div.className='item';
    div.innerHTML=`<b>${item.pet.name}</b> - Harga: ${item.price} coin<br>Seller: ${item.seller}`;
    const buyBtn=document.createElement('button');buyBtn.textContent='Beli';
    buyBtn.onclick=()=>{
      if(player.coins<item.price){alert('Koin tidak cukup!');return;}
      if(confirm('Beli pet ini?')){
        player.coins-=item.price;
        player.inventory.push(item.pet);
        delete market[item.pet.id];
        save();
        alert('Pet dibeli!');render();
      }
    };
    const offerBtn=document.createElement('button');offerBtn.textContent='Tawar';
    offerBtn.onclick=()=>{
      const offerPrice=prompt('Masukkan harga tawaran:');
      if(offerPrice){
        item.offers.push({buyer:player.name,price:parseInt(offerPrice)});
        localStorage.setItem('market',JSON.stringify(market));
        alert('Tawaran dikirim!');
      }
    };
    // jika kita seller, tampilkan tawaran
    if(item.seller===player.name && item.offers.length>0){
      div.innerHTML+=`<br><b>Tawaran:</b>`;
      item.offers.forEach((o,i)=>{
        const span=document.createElement('span');span.textContent=`${o.buyer}: ${o.price}`;
        const accBtn=document.createElement('button');accBtn.textContent='Terima';
        accBtn.onclick=()=>{
          const buyerName=o.buyer;
          let allPlayers=JSON.parse(localStorage.getItem('player_'+buyerName)||'null');
          alert('Untuk multi-user real, butuh server. (Offline hanya simulasi)');
        };
        div.appendChild(document.createElement('br'));
        div.appendChild(span);
        div.appendChild(accBtn);
      });
    }
    div.appendChild(buyBtn);
    div.appendChild(offerBtn);
    list.appendChild(div);
  });
}

function save(){
  localStorage.setItem('player',JSON.stringify(player));
  localStorage.setItem('market',JSON.stringify(market));
}
render();
</script>
</body>
</html>
