<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marketplace - Tamagotchi</title>
<style>
    body{background:#0b1220;color:#fff;font-family:sans-serif;text-align:center;}
    .panel{background:#101a2b;padding:10px;margin:10px auto;width:90%;max-width:500px;border-radius:8px;}
    button{background:#10b981;border:none;padding:8px;margin:4px;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer;}
    input{padding:6px;margin:4px;}
    .list-item{background:#1a2436;padding:8px;margin:6px;border-radius:8px;}
</style>
</head>
<body>
<h2>ğŸ›’ Marketplace</h2>
<div>
    <input id="playerName" placeholder="Masukkan nama" />
    <button onclick="login()">Login</button>
</div>
<div id="marketList" class="panel"></div>
<div id="ownerPanel" class="panel" style="display:none;">
    <h3>OWNER MENU</h3>
    <p>Jual pet baru:</p>
    <input id="newPetName" placeholder="Nama Pet Baru" />
    <input id="newPetPrice" type="number" placeholder="Harga" />
    <button onclick="ownerSell()">Tambahkan ke Marketplace</button>
</div>
<div style="margin-top:10px;">
    <button onclick="goTo('index.html')">ğŸ  Home</button>
    <button onclick="goTo('inventory.html')">ğŸ“¦ Inventory</button>
    <button onclick="goTo('leaderboard.html')">ğŸ† Leaderboard</button>
    <button onclick="goTo('chat.html')">ğŸ’¬ Chat</button>
</div>
<script>
let players = JSON.parse(localStorage.getItem("players")||"{}");
let market = JSON.parse(localStorage.getItem("market")||"{}");
let currentPlayer=null;

function login(){
    const name=document.getElementById("playerName").value.trim();
    if(!name||!players[name])return alert("Player tidak ditemukan!");
    currentPlayer=players[name];
    if(currentPlayer.name==="OWNER")document.getElementById("ownerPanel").style.display="block";
    renderMarket();
}

function renderMarket(){
    const div=document.getElementById("marketList");
    div.innerHTML="<h3>Daftar Pet Dijual</h3>";
    const keys=Object.keys(market);
    if(keys.length===0){div.innerHTML+="<p>Tidak ada pet di marketplace.</p>";return;}
    keys.forEach(id=>{
        const item=market[id];
        div.innerHTML+=`
        <div class="list-item">
            <b>${item.pet.name}</b> (Level ${item.pet.level})<br>
            Harga: ${item.price} coin<br>
            Penjual: ${item.seller}<br>
            <button onclick="buy('${id}')">Beli</button>
            <input id="offer${id}" type="number" placeholder="Tawar harga">
            <button onclick="offer('${id}')">Tawar</button>
        </div>`;
    });
}

function buy(id){
    const item=market[id];
    if(currentPlayer.coins<item.price)return alert("Coin tidak cukup!");
    currentPlayer.coins-=item.price;
    currentPlayer.inventory.push(item.pet);
    delete market[id];
    save();
    alert("Pembelian berhasil!");
    renderMarket();
}

function offer(id){
    const price=parseInt(document.getElementById("offer"+id).value);
    if(!price||price<=0)return alert("Harga tidak valid");
    market[id].offers.push({buyer:currentPlayer.name,price});
    localStorage.setItem("market",JSON.stringify(market));
    alert("Penawaran dikirim!");
}

function ownerSell(){
    const name=document.getElementById("newPetName").value.trim();
    const price=parseInt(document.getElementById("newPetPrice").value);
    if(!name||!price)return alert("Isi semua kolom");
    const id="sale_"+Date.now();
    market[id]={seller:"OWNER",pet:{name,level:1},price,offers:[]};
    localStorage.setItem("market",JSON.stringify(market));
    alert("Pet ditambahkan!");
    renderMarket();
}

function save(){
    players[currentPlayer.name]=currentPlayer;
    localStorage.setItem("players",JSON.stringify(players));
    localStorage.setItem("market",JSON.stringify(market));
}

function goTo(p){location.href=p;}
</script>
</body>
</html>
