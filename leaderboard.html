<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tamagotchi Online — Leaderboard</title>
<style>
  body{background:#0b1220;color:#fff;font-family:sans-serif;text-align:center}
  .wrap{max-width:860px;margin:0 auto;padding:12px}
  .panel{background:#101a2b;border-radius:12px;padding:14px;margin:10px}
  .menu a,.menu button{background:#1f2937;color:#fff;text-decoration:none;padding:8px 10px;border-radius:10px;border:0;display:inline-block;margin:4px}
  input{padding:10px;border-radius:10px;border:0;margin:6px;min-width:240px}
  .row{background:#1a2436;border-radius:10px;padding:10px;margin:8px 0;text-align:left}
</style>
</head>
<body>
<div class="wrap">
  <h2>🏆 Leaderboard</h2>
  <div class="menu">
    <a href="index.html">🏠 Home</a>
    <a href="inventory.html">📦 Inventory</a>
    <a href="marketplace.html">🏪 Marketplace</a>
    <a href="chat.html">💬 Chat</a>
    <button id="btnLogout">🚪 Logout</button>
  </div>

  <div class="panel">
    <input id="q" placeholder="Cari pemain...">
    <div id="board"></div>
  </div>
</div>

<script type="module" src="js/firebase-config.js"></script>
<script type="module" src="js/online.js"></script>
<script type="module">
import { onAuth, logout, db } from './js/online.js';
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

document.getElementById('btnLogout').onclick = ()=> logout();

async function render(){
  const term = (document.getElementById('q').value||'').toLowerCase();
  const snap = await getDocs(collection(db,'players'));
  const arr = [];
  snap.forEach(d=>{
    const p = d.data();
    const pet = p.pets?.[p.activePet||0];
    arr.push({ name:p.username, level: pet?.level||0, coins:p.coins||0, pets:(p.pets||[]).length });
  });
  arr.sort((a,b)=> b.level-a.level || b.coins-a.coins || a.name.localeCompare(b.name));
  const list = arr.filter(x=>!term || x.name.toLowerCase().includes(term))
                  .map(x=>`<div class="row"><b>${x.name}</b> — Lv ${x.level} | 💰 ${x.coins} | Koleksi ${x.pets}</div>`).join('');
  document.getElementById('board').innerHTML = list || '<p>Belum ada pemain.</p>';
}
document.getElementById('q').oninput = render;

onAuth(user=>{
  if(!user){ location.href='index.html'; return; }
  render();
});
</script>
</body>
</html>
