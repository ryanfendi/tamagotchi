<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Leaderboard — Tamagotchi</title>
<style>
  body{background:#0b1220;color:#fff;font-family:sans-serif;text-align:center}
  .panel{background:#101a2b;padding:10px;margin:10px auto;width:90%;max-width:700px;border-radius:8px}
  input{padding:8px;margin:6px;border-radius:6px;border:none;min-width:280px}
  .list-item{background:#1a2436;padding:8px;margin:6px;border-radius:8px;text-align:left}
  button{background:#10b981;border:none;padding:8px;margin:4px;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer}
</style>
</head>
<body>
<!-- Proteksi -->
<script>
  (function(){
    const current = localStorage.getItem('currentPlayer');
    if(!current){ alert('Silakan login terlebih dahulu'); location.href='login.html'; return; }
    const players = JSON.parse(localStorage.getItem('players')||'{}');
    if(!players[current]){ localStorage.removeItem('currentPlayer'); alert('Akun tidak ditemukan. Silakan login kembali.'); location.href='login.html'; }
  })();
</script>

<h2>🏆 Leaderboard</h2>
<div style="margin-bottom:8px;">
  <input id="search" placeholder="Cari pemain..." oninput="renderBoard()">
</div>
<div id="board" class="panel">Memuat...</div>
<div style="margin-top:10px;">
  <button onclick="goTo('index.html')">🏠 Home</button>
  <button onclick="goTo('inventory.html')">📦 Inventory</button>
  <button onclick="goTo('marketplace.html')">🛒 Marketplace</button>
  <button onclick="goTo('chat.html')">💬 Chat</button>
</div>

<script>
let players = JSON.parse(localStorage.getItem('players')||'{}');

function goTo(p){ location.href=p; }

function renderBoard(){
  const div = document.getElementById('board');
  const search = (document.getElementById('search').value||'').toLowerCase();
  let arr = Object.values(players);
  arr.sort((a,b)=> (b.pet?.level||0) - (a.pet?.level||0));
  div.innerHTML = '';
  arr.forEach(p=>{
    if(search && !p.username.toLowerCase().includes(search) && !(p.email||'').toLowerCase().includes(search)) return;
    div.innerHTML += `
      <div class="list-item">
        <b>${p.username}</b> | Level: ${p.pet?.level||1} | Coin: ${p.coins||0}<br>
        Pet Aktif: ${p.pet?.name||'None'}<br>
        Barang: ${p.inventory?.length||0} item
      </div>
    `;
  });
}
renderBoard();
</script>
</body>
</html>
