<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Owner Panel</title>
<style>
  body{background:#0b1220;color:#fff;font-family:sans-serif;margin:0;padding:16px}
  h2,h3{color:#10b981}
  table{width:100%;max-width:900px;margin:0 auto 20px;border-collapse:collapse}
  th,td{border:1px solid #334155;padding:8px;text-align:center}
  th{background:#10b981;color:#06261f}
  button{padding:6px 10px;border:0;border-radius:8px;background:#3b82f6;color:#fff;cursor:pointer;margin:2px}
  .danger{background:#ef4444}
  .success{background:#10b981}
  select, input{padding:6px;border-radius:6px;border:1px solid #555;margin:4px}
  .chat-box{max-height:200px;overflow-y:auto;background:#1e293b;padding:8px;margin:10px 0;border-radius:6px}
</style>
</head>
<body>
  <h2>ğŸ‘‘ Owner Panel</h2>
  <div id="me">Memuatâ€¦</div>

  <!-- USERS -->
  <h3>ğŸ“‹ Data Member</h3>
  <table>
    <thead><tr><th>Username</th><th>Email</th><th>Lv</th><th>Coin</th><th>Aksi</th></tr></thead>
    <tbody id="rows"></tbody>
  </table>

  <!-- TRANSFER COIN -->
  <h3>ğŸ’° Transfer Coin</h3>
  <select id="userSelect"></select>
  <input type="number" id="coinAmount" placeholder="Jumlah coin">
  <button onclick="transferCoin()">Kirim</button>

  <!-- LEVEL UP -->
  <h3>âš¡ Naikkan Level Pet</h3>
  <select id="levelUserSelect"></select>
  <input type="number" id="levelAmount" placeholder="Tambah level">
  <button onclick="levelUp()">Naikkan</button>

  <!-- CHAT GLOBAL -->
  <h3>ğŸ’¬ Chat Global</h3>
  <button onclick="clearGlobalChat()" class="danger">ğŸ—‘ï¸ Hapus Semua Pesan Global</button>
  <div class="chat-box" id="globalMessages"></div>

  <!-- PRIVATE CHAT -->
  <h3>ğŸ‘¤ Private Chats</h3>
  <select id="roomSelect"></select>
  <button onclick="delRoom()" class="danger">ğŸ—‘ï¸ Hapus Room</button>
  <button onclick="delAllRooms()" class="danger">ğŸ—‘ï¸ Hapus Semua Room</button>
  <div class="chat-box" id="privateMessages"></div>

  <!-- MARKETPLACE -->
  <h3>ğŸ“¦ Marketplace</h3>
  <div id="marketplace"></div>

  <!-- ADS -->
  <h3>ğŸ“¢ Iklan</h3>
  <input id="adText" placeholder="Teks iklan">
  <button onclick="addAd()">Tambah Iklan</button>
  <div id="ads"></div>

  <p style="text-align:center;margin-top:12px">
    <button onclick="nav('game.html')">â¬…ï¸ Kembali</button>
  </p>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    const cfg={apiKey:"AIzaSyAN0GNZdIx_xPHT7MZKWJweLtNhies6QxY",authDomain:"tamagotchi-2be0c.firebaseapp.com",databaseURL:"https://tamagotchi-2be0c-default-rtdb.firebaseio.com",projectId:"tamagotchi-2be0c",storageBucket:"tamagotchi-2be0c.firebasestorage.app",messagingSenderId:"202052432703",appId:"1:202052432703:web:cb76b50e42149a2c92998a",measurementId:"G-TWGGSJRX26"};
    firebase.initializeApp(cfg); const auth=firebase.auth(), db=firebase.database();
    const OWNER_EMAIL="ryanfendiwardana@gmail.com"; // ganti sesuai akun Owner
    const OWNER_UID="vNuT6n1TD2XSjkywNbE5mROL8sa2"; // ganti sesuai UID Owner
    let uid;

    function nav(p){ location.href=p; }

    // RENDER USERS
    function renderUsers(snap){
      const tb=document.getElementById('rows'); tb.innerHTML='';
      const sel=document.getElementById('userSelect'); sel.innerHTML='';
      const sel2=document.getElementById('levelUserSelect'); sel2.innerHTML='';
      snap.forEach(ch=>{
        const u=ch.val(), id=ch.key;
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td>${u.username||'-'}</td>
          <td>${u.email||'-'}</td>
          <td>${u.level||1}</td>
          <td>${Number(u.coins||0).toFixed(2)}</td>
          <td>
            <button onclick="topup('${id}',100)">+100</button>
            <button onclick="reset('${id}')" class="danger">Reset</button>
          </td>`;
        tb.appendChild(tr);
        sel.innerHTML+=`<option value="${id}">${u.username||id}</option>`;
        sel2.innerHTML+=`<option value="${id}">${u.username||id}</option>`;
      });
    }

    // COIN
    function topup(id, amt){
      db.ref('users/'+id+'/coins').transaction(c=>(Number(c)||0)+amt);
    }
    function transferCoin(){
      const uid=document.getElementById("userSelect").value;
      const amt=Number(document.getElementById("coinAmount").value);
      if(!uid||!amt) return alert("Pilih user dan isi jumlah");
      db.ref("users/"+uid+"/coins").transaction(c=>(Number(c)||0)+amt);
      alert("âœ… Coin ditransfer!");
    }

    // LEVEL UP
    function levelUp(){
      const uid=document.getElementById("levelUserSelect").value;
      const amt=Number(document.getElementById("levelAmount").value);
      if(!uid||!amt) return alert("Pilih user dan isi level");
      db.ref("users/"+uid+"/level").transaction(l=>(Number(l)||1)+amt);
      alert("âœ… Level naik!");
    }

    // RESET
    function reset(id){
      if(!confirm('Reset user ini?')) return;
      db.ref('users/'+id).update({level:1,hunger:100,energy:100,hp:100,coins:0});
    }

    // CHAT GLOBAL
    function clearGlobalChat(){
      if(confirm("Hapus semua pesan global?")){
        db.ref("chat").remove();
      }
    }

    // PRIVATE CHAT
    function delRoom(){
      const sel=document.getElementById("roomSelect");
      if(!sel.value) return alert("Pilih room dulu!");
      if(confirm("Hapus seluruh pesan di room "+sel.value+" ?")){
        db.ref("privateChat/"+sel.value+"/messages").remove();
      }
    }
    function delAllRooms(){
      if(confirm("âš ï¸ Yakin ingin menghapus SEMUA private chat room?")){
        db.ref("privateChat").remove();
        document.getElementById("roomSelect").innerHTML = "";
        document.getElementById("privateMessages").innerHTML = "";
      }
    }

    // ADS
    function addAd(){
      const txt=document.getElementById("adText").value.trim();
      if(!txt) return;
      db.ref("ads").push({text:txt});
      document.getElementById("adText").value="";
    }
    function renderAds(snap){
      const box=document.getElementById("ads"); box.innerHTML="";
      snap.forEach(ch=>{
        const a=ch.val();
        const d=document.createElement("div");
        d.innerHTML=`${a.text} <button class="danger" onclick="db.ref('ads/${ch.key}').remove()">x</button>`;
        box.appendChild(d);
      });
    }

    // AUTH
    auth.onAuthStateChanged(async u=>{
      if(!u){ location.href='index.html'; return; }
      uid=u.uid;
      if(u.email!==OWNER_EMAIL || u.uid!==OWNER_UID){
        alert('Bukan owner'); nav('game.html'); return;
      }
      document.getElementById('me').textContent=`Login sebagai ${u.email}`;
      db.ref('users').on('value',renderUsers);
      db.ref("chat").on("value",snap=>{
        let box=document.getElementById("globalMessages"); box.innerHTML="";
        snap.forEach(m=>{ let v=m.val(); box.innerHTML+=`<div>[${v.sender}] ${v.text}</div>`; });
      });
      db.ref("privateChat").on("value",snap=>{
        let sel=document.getElementById("roomSelect"); sel.innerHTML="";
        snap.forEach(r=>{ sel.innerHTML+=`<option value="${r.key}">${r.key}</option>`; });
      });
      db.ref("ads").on("value",renderAds);
    });
  </script>
</body>
</html>
