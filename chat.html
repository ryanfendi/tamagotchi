<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tamagotchi Online â€” Chat</title>
<style>
  body{background:#0b1220;color:#fff;font-family:sans-serif}
  .wrap{max-width:860px;margin:0 auto;text-align:center;padding:12px}
  .menu a,.menu button{background:#1f2937;color:#fff;text-decoration:none;padding:8px 10px;border-radius:10px;border:0;display:inline-block;margin:4px}
  #chatBox{background:#101a2b;height:360px;overflow-y:auto;padding:10px;border-radius:12px;text-align:left;margin:10px}
  input,button{padding:10px;border-radius:10px;border:0;margin:4px}
  button{background:#10b981;color:#042018;font-weight:700}
</style>
</head>
<body>
<div class="wrap">
  <h2>ğŸ’¬ Chat Global</h2>
  <div class="menu">
    <a href="index.html">ğŸ  Home</a>
    <a href="inventory.html">ğŸ“¦ Inventory</a>
    <a href="marketplace.html">ğŸª Marketplace</a>
    <a href="leaderboard.html">ğŸ† Leaderboard</a>
    <button id="btnLogout">ğŸšª Logout</button>
  </div>

  <div id="chatBox"></div>
  <input id="msg" placeholder="Ketik pesan..." style="width:70%">
  <button id="btnSend">Kirim</button>
</div>

<script type="module" src="js/firebase-config.js"></script>
<script type="module" src="js/online.js"></script>
<script type="module">
import { onAuth, logout, subChat, sendChat } from './js/online.js';
let uid=null, unsub=null;
document.getElementById('btnLogout').onclick = ()=> logout();
document.getElementById('btnSend').onclick = async ()=>{
  const t = (document.getElementById('msg').value||'').trim();
  if(!t) return;
  try{ await sendChat(uid, t); document.getElementById('msg').value=''; }catch(e){ alert(e.message); }
};
function render(rows){
  const box = document.getElementById('chatBox');
  box.innerHTML = rows.map(c=> `<p><b>${c.user}</b>: ${c.msg}</p>`).join('');
  box.scrollTop = box.scrollHeight;
}
onAuth(user=>{
  if(!user){ location.href='index.html'; return; }
  uid=user.uid;
  if(unsub) unsub();
  unsub = subChat(rows=> render(rows));
});
</script>
</body>
</html>
