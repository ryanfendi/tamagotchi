<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat â€” Tamagotchi</title>
  <style>
    body{background:#0b1220;color:#fff;font-family:sans-serif;text-align:center}
    #chatBox{background:#101a2b;padding:10px;margin:10px auto;width:90%;max-width:600px;height:300px;overflow-y:auto;text-align:left}
    input,button{padding:8px;margin:4px;border:none;border-radius:6px;font-size:1em}
    button{background:#10b981;color:#fff;cursor:pointer}
  </style>
</head>
<body>
<script>
  (function(){
    const cur = localStorage.getItem('currentPlayer');
    if(!cur){ alert('Silakan login'); location.href='login.html'; return }
    const players = JSON.parse(localStorage.getItem('players')||'{}');
    if(!players[cur]){ localStorage.removeItem('currentPlayer'); alert('User tidak ditemukan'); location.href='login.html' }
  })();
</script>

<h2>ðŸ’¬ Chat Global</h2>
<div id="chatBox"></div>
<input id="msg" placeholder="Tulis pesan..." style="width:70%">
<button onclick="send()">Kirim</button><br>
<button onclick="goTo('index.html')">Home</button>

<script>
  let chats = JSON.parse(localStorage.getItem('chats')||'[]');
  const current = localStorage.getItem('currentPlayer');

  function render(){
    const box = document.getElementById('chatBox');
    box.innerHTML = '';
    chats.forEach(c=>{
      box.innerHTML += `<p><b>${c.user}</b>: ${escape(c.text)} <small>${c.time}</small></p>`;
    });
    box.scrollTop = box.scrollHeight;
  }

  function send(){
    const t = (document.getElementById('msg').value||'').trim();
    if(!t) return;
    chats.push({ user: current, text: t, time: new Date().toLocaleTimeString() });
    localStorage.setItem('chats', JSON.stringify(chats));
    document.getElementById('msg').value = '';
    render();
  }

  function escape(s){ return s.replace(/[&<>"'/]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;','/':'/'}[c])); }
  function goTo(p){ location.href=p }

  render();
</script>
</body>
</html>
