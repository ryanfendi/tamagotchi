<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat App</title>
  <script type="module">
    // === Import Firebase ===
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    // === Config ===
    const firebaseConfig = {
      apiKey: "AIzaSyAN0GNZdIx_xPHT7MZKWJweLtNhies6QxY",
      authDomain: "tamagotchi-2be0c.firebaseapp.com",
      databaseURL: "https://tamagotchi-2be0c-default-rtdb.firebaseio.com",
      projectId: "tamagotchi-2be0c",
      storageBucket: "tamagotchi-2be0c.firebasestorage.app",
      messagingSenderId: "202052432703",
      appId: "1:202052432703:web:cb76b50e42149a2c92998a",
      measurementId: "G-TWGGSJRX26"
    };

    // === Init Firebase ===
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    // === Login Anon ===
    let currentUser = null;
    signInAnonymously(auth).then((res) => {
      currentUser = res.user.uid;
      document.getElementById("userId").innerText = "User ID: " + currentUser;
    });

    // === Global Chat ===
    const globalRef = ref(db, "chat");
    onChildAdded(globalRef, (snap) => {
      const msg = snap.val();
      const div = document.createElement("div");
      div.innerHTML = `<b>${msg.from}:</b> ${msg.text}`;
      document.getElementById("globalMessages").appendChild(div);
    });

    document.getElementById("sendGlobal").onclick = () => {
      const text = document.getElementById("globalInput").value;
      if (!text) return;
      push(globalRef, {
        from: currentUser,
        text,
        timestamp: Date.now()
      });
      document.getElementById("globalInput").value = "";
    };

    // === Private Chat ===
    let currentRoom = "room1"; // default room
    const loadPrivateChat = (roomId) => {
      currentRoom = roomId;
      document.getElementById("privateMessages").innerHTML = "";
      const privateRef = ref(db, `privateChat/${roomId}/messages`);
      onChildAdded(privateRef, (snap) => {
        const msg = snap.val();
        const div = document.createElement("div");
        div.innerHTML = `<b>${msg.from}:</b> ${msg.text}`;
        document.getElementById("privateMessages").appendChild(div);
      });
    };

    document.getElementById("sendPrivate").onclick = () => {
      const text = document.getElementById("privateInput").value;
      if (!text) return;
      const privateRef = ref(db, `privateChat/${currentRoom}/messages`);
      push(privateRef, {
        from: currentUser,
        text,
        timestamp: Date.now()
      });
      document.getElementById("privateInput").value = "";
    };

    // Load room1 default
    loadPrivateChat("room1");
  </script>
</head>
<body>
  <h1>🔥 Chat App</h1>
  <p id="userId">Loading...</p>

  <hr>
  <h2>🌍 Global Chat</h2>
  <div id="globalMessages" style="border:1px solid #ccc; height:150px; overflow-y:scroll;"></div>
  <input id="globalInput" placeholder="Tulis pesan...">
  <button id="sendGlobal">Kirim</button>

  <hr>
  <h2>🔒 Private Chat</h2>
  <label>Pilih Room: </label>
  <select onchange="loadPrivateChat(this.value)">
    <option value="room1">Room 1</option>
    <option value="room2">Room 2</option>
  </select>
  <div id="privateMessages" style="border:1px solid #ccc; height:150px; overflow-y:scroll;"></div>
  <input id="privateInput" placeholder="Tulis pesan...">
  <button id="sendPrivate">Kirim</button>
</body>
</html>
