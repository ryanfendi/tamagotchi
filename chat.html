<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat Global</title>
  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getDatabase, ref, push, onChildAdded, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    // Config dari kamu
    const firebaseConfig = {
      apiKey: "AIzaSyAN0GNZdIx_xPHT7MZKWJweLtNhies6QxY",
      authDomain: "tamagotchi-2be0c.firebaseapp.com",
      databaseURL: "https://tamagotchi-2be0c-default-rtdb.firebaseio.com",
      projectId: "tamagotchi-2be0c",
      storageBucket: "tamagotchi-2be0c.firebasestorage.app",
      messagingSenderId: "202052432703",
      appId: "1:202052432703:web:cb76b50e42149a2c92998a",
      measurementId: "G-TWGGSJRX26"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let currentUser = null;

    // Login anonim otomatis
    signInAnonymously(auth).catch(err => console.error("Login gagal:", err));

    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        console.log("Login sebagai:", user.uid);
      }
    });

    // Referensi chat global
    const chatRef = ref(db, "chat");

    // Fungsi kirim pesan
    window.sendMessage = () => {
      const text = document.getElementById("message").value;
      if (!currentUser) {
        alert("Belum login, tunggu sebentar...");
        return;
      }
      if (text.trim() === "") return;

      push(chatRef, {
        from: currentUser.uid,
        text: text,
        timestamp: serverTimestamp()
      });

      document.getElementById("message").value = "";
    };

    // Tampilkan pesan baru
    onChildAdded(chatRef, (snapshot) => {
      const msg = snapshot.val();
      const div = document.createElement("div");
      div.textContent = msg.from + ": " + msg.text;
      document.getElementById("messages").appendChild(div);
    });
  </script>
</head>
<body>
  <h2>Chat Global</h2>
  <div id="messages" style="border:1px solid #ccc; height:200px; overflow-y:scroll; padding:5px;"></div>
  <input id="message" placeholder="Ketik pesan..." />
  <button onclick="sendMessage()">Kirim</button>
</body>
</html>
