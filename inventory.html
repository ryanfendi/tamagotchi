<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tamagotchi ‚Äî Inventory</title>
<style>
  body{background:#0b1220;color:#fff;font-family:sans-serif;text-align:center}
  .wrap{max-width:820px;margin:0 auto;padding:12px}
  .panel{background:#101a2b;border-radius:12px;padding:14px;margin:10px}
  .menu a,.menu button{background:#1f2937;color:#fff;text-decoration:none;padding:8px 10px;border-radius:10px;border:0;display:inline-block;margin:4px}
  button,input,select{padding:10px;border-radius:10px;border:0;margin:4px}
  button{background:#10b981;color:#042018;font-weight:700}
  .item{background:#1a2436;border-radius:10px;padding:10px;margin:8px 0;text-align:left}
</style>
</head>
<body>
<div class="wrap">
  <h2>üì¶ Inventory</h2>
  <div class="menu">
    <a href="index.html">üè† Home</a>
    <a href="marketplace.html">üè™ Marketplace</a>
    <a href="leaderboard.html">üèÜ Leaderboard</a>
    <a href="chat.html">üí¨ Chat</a>
    <button onclick="logout()">üö™ Logout</button>
  </div>

  <div id="summary" class="panel"></div>

  <div class="panel">
    <h3>Ganti Pet Aktif</h3>
    <select id="selActive"></select>
    <button onclick="setActive()">Aktifkan</button>
  </div>

  <div class="panel">
    <h3>Jual Pet Koleksi ke Marketplace</h3>
    <select id="selSell"></select>
    <input id="price" type="number" placeholder="Harga (coin)"/>
    <button onclick="sell()">Jual</button>
  </div>
</div>

<script>
let players = JSON.parse(localStorage.getItem('players')||'{}');
let market  = JSON.parse(localStorage.getItem('market')||'{}');
let user = localStorage.getItem('lastUser');
if(!user || !players[user]) location.href='index.html';
function saveAll(){ localStorage.setItem('players',JSON.stringify(players)); localStorage.setItem('market',JSON.stringify(market)); }
function logout(){ localStorage.removeItem('lastUser'); location.href='index.html'; }

function render(){
  const me = players[user];
  const p  = me.pets[me.activePet] || me.pets[0];
  document.getElementById('summary').innerHTML = `
    <p><b>Player:</b> ${user}</p>
    <p><b>Coin:</b> ${me.coins}</p>
    <p><b>Pet Aktif:</b> Lv ${p.level} | HP ${p.hp}% | H ${p.hunger}% | E ${p.energy}%</p>
    <h4>Koleksi (${me.pets.length})</h4>
    ${me.pets.map((q,i)=>`<div class="item">#${i+1} ‚Äî <b>${i===me.activePet?'(Aktif)':''}</b> Lv ${q.level} | HP ${q.hp}% | H ${q.hunger}% | E ${q.energy}%</div>`).join('')}
  `;
  const opts = me.pets.map((x,i)=>`<option value="${i}">#${i+1} ‚Äî Lv ${x.level}${i===me.activePet?' (aktif)':''}</option>`).join('');
  document.getElementById('selActive').innerHTML = opts;
  // untuk jual, jangan tampilkan yang aktif (opsional): tetap boleh jual semua kecuali aktif?
  document.getElementById('selSell').innerHTML   = me.pets.map((x,i)=>`<option value="${i}">#${i+1} ‚Äî Lv ${x.level}</option>`).join('');
}

function setActive(){
  const me = players[user];
  const idx = parseInt(document.getElementById('selActive').value||'-1');
  if(isNaN(idx) || idx<0 || idx>=me.pets.length) return;
  me.activePet = idx;
  saveAll(); render(); alert('Pet aktif diganti!');
}

function sell(){
  const me = players[user];
  const idx = parseInt(document.getElementById('selSell').value||'-1');
  const price = parseInt(document.getElementById('price').value||'0');
  if(isNaN(idx) || idx<0 || idx>=me.pets.length) return alert('Pilih pet.');
  if(!price || price<=0) return alert('Harga tidak valid.');
  if(idx===me.activePet) return alert('Tidak bisa menjual pet yang sedang aktif.');
  const pet = me.pets.splice(idx,1)[0];
  if(me.activePet>idx) me.activePet--; // geser index aktif jika perlu
  const id = 'sale_'+Date.now();
  market[id] = { id, seller:user, pet, price };
  saveAll(); render(); alert('Pet dimasukkan ke marketplace!');
}

render();
</script>
</body>
</html>
