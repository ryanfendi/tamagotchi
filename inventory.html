<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Inventory — Tamagotchi</title>
<style>
:root{--bg:#071726;--panel:#0f1724;--accent:#10b981;--muted:#9fb3b5}
html,body{margin:0;padding:0;background:var(--bg);font-family:system-ui,Arial;color:#e6eef6}
.wrap{max-width:900px;margin:20px auto;padding:16px}
.panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
button{background:linear-gradient(180deg,var(--accent),#06a77a);border:0;color:#042018;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700;margin:4px}
button.secondary{background:linear-gradient(180deg,#06b6d4,#0891b2)}
a.link{display:inline-block;background:#06b6d4;padding:8px 10px;border-radius:8px;color:#042018;text-decoration:none;margin:4px}
.item{background:#101a2b;padding:10px;border-radius:8px;margin-top:8px}
.small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <h2>📦 Inventory</h2>
    <div class="small">Player: <strong id="playerName">—</strong> | Coin: <span id="coinText">0</span></div>

    <h3 style="margin-top:16px">🐾 Pet Aktif</h3>
    <div id="activePet" class="item muted">Loading...</div>

    <h3 style="margin-top:16px">🎒 Inventory Items</h3>
    <div id="inventoryList" class="muted small">Loading...</div>

    <div style="margin-top:16px">
      <a class="link" href="index.html">⬅ Kembali ke Game</a>
      <a class="link" href="marketplace.html">🛒 Marketplace</a>
      <a class="link" href="leaderboard.html">🏆 Leaderboard</a>
      <a class="link" href="chat.html">💬 Chat</a>
    </div>
  </div>
</div>

<script>
function loadPlayers(){ return JSON.parse(localStorage.getItem('players')||'{}'); }
function savePlayers(p){ localStorage.setItem('players',JSON.stringify(p)); }
function getCurrentUsername(){ return (localStorage.getItem('currentPlayer')||'').toString().trim().toLowerCase(); }

const players = loadPlayers();
const currentUsername = getCurrentUsername();
if(!currentUsername || !players[currentUsername]){
  localStorage.removeItem('currentPlayer'); location.href='login.html';
}
let currentPlayer = players[currentUsername];

const playerNameEl = document.getElementById('playerName');
const coinText = document.getElementById('coinText');
const activePetEl = document.getElementById('activePet');
const inventoryList = document.getElementById('inventoryList');

function initUI(){
  playerNameEl.textContent = currentUsername;
  coinText.textContent = currentPlayer.coins||0;
  activePetEl.innerHTML = renderActivePet(currentPlayer.pet);
  inventoryList.innerHTML = renderInventory(currentPlayer.inventory||[]);
}

function renderActivePet(pet){
  if(!pet) return '<div class="muted">Belum ada pet aktif</div>';
  return `
    <div><strong>${pet.name}</strong> • Lv ${pet.level} • ❤️ ${pet.health||1000}
    <br>Feed: ${pet.feedTimestamps?pet.feedTimestamps.length:0}x | Sleep: ${pet.sleepTimestamps?pet.sleepTimestamps.length:0}x</div>
  `;
}

function renderInventory(items){
  if(!items || items.length===0) return '<div>Tidak ada item/pet</div>';
  return items.map((it,idx)=>`
    <div class="item">
      <div><strong>${it.type==='pet'? '🐾 Pet':'📦 Item'}:</strong> ${it.name||'Unknown'} (Lv ${it.level||1})</div>
      ${it.type==='pet'? `<button onclick="setActive(${idx})">Aktifkan Pet</button>
      <button onclick="sellPet(${idx})" class="secondary">Jual ke Marketplace</button>`:''}
    </div>
  `).join('');
}

window.setActive = function(idx){
  const item = currentPlayer.inventory[idx];
  if(item && item.type==='pet'){
    const oldPet = currentPlayer.pet;
    if(oldPet) currentPlayer.inventory.push(oldPet);
    currentPlayer.pet = item;
    currentPlayer.inventory.splice(idx,1);
    persist(); initUI();
    alert('Pet aktif berhasil diganti!');
  }
};

window.sellPet = function(idx){
  const item = currentPlayer.inventory[idx];
  if(!item || item.type!=='pet') return;
  const price = parseInt(prompt('Masukkan harga jual untuk pet ini:', '10000'),10);
  if(!price || price<=0) return alert('Harga tidak valid.');
  const market = JSON.parse(localStorage.getItem('market')||'{}');
  const id = 'itm'+Date.now();
  market[id] = {
    id,
    seller: currentUsername,
    item,
    price,
    offers:[]
  };
  currentPlayer.inventory.splice(idx,1);
  localStorage.setItem('market',JSON.stringify(market));
  persist(); initUI();
  alert('Pet dimasukkan ke Marketplace!');
};

function persist(){
  const all = loadPlayers();
  all[currentUsername] = currentPlayer;
  savePlayers(all);
}

initUI();
</script>
</body>
</html>
