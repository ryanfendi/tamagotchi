<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Inventory ‚Äî Tamagotchi</title>
<style>
  body{background:#0b1220;color:#fff;font-family:sans-serif;text-align:center}
  .panel{background:#101a2b;padding:12px;border-radius:10px;margin:12px auto;max-width:520px}
  button,input,select{padding:8px;border-radius:8px;border:0;margin:4px}
  button{background:#10b981;color:#fff;font-weight:bold}
  .item{background:#1a2436;padding:8px;border-radius:8px;margin:6px 0}
  .menu a, .menu button { display:inline-block;background:#1f2937;color:#fff;text-decoration:none;padding:8px 10px;margin:4px;border-radius:8px;border:0 }
</style>
</head>
<body>
<h2>üì¶ Inventory</h2>
<div class="menu">
  <a href="index.html">üè† Home</a>
  <a href="marketplace.html">üè™ Marketplace</a>
  <a href="leaderboard.html">üèÜ Leaderboard</a>
  <a href="chat.html">üí¨ Chat</a>
  <button onclick="logout()">üö™ Logout</button>
</div>

<div id="info" class="panel"></div>

<div class="panel">
  <h3>Jadikan Pet Koleksi Sebagai Aktif</h3>
  <select id="selInv"></select>
  <button onclick="setActive()">Aktifkan</button>
</div>

<div class="panel">
  <h3>Jual Pet (dari koleksi) ke Marketplace</h3>
  <select id="selSell"></select>
  <input id="sellPrice" type="number" placeholder="Harga coin"/>
  <button onclick="sellPet()">Jual</button>
</div>

<script>
let players = JSON.parse(localStorage.getItem('players')||'{}');
let currentUser = localStorage.getItem('sessionUser');

if(!currentUser || !players[currentUser]) location.href='index.html';

function logout(){ localStorage.removeItem('sessionUser'); location.href='index.html'; }
function save(){ localStorage.setItem('players', JSON.stringify(players)); }

function render(){
  const me=players[currentUser];
  const info=document.getElementById('info');
  const active = me.pet ? `Lv ${me.pet.level} | HP ${me.pet.hp}% | Hunger ${me.pet.hunger}% | Energy ${me.pet.energy}%` : 'Tidak ada';
  info.innerHTML = `
    <p><b>Player:</b> ${currentUser}</p>
    <p><b>Coin:</b> ${me.coins}</p>
    <p><b>Pet Aktif:</b> ${active}</p>
    <h4>Koleksi (${me.inventory.length})</h4>
    ${me.inventory.map((p,i)=>`<div class="item">#${i+1} ‚Äî Lv ${p.level} | HP ${p.hp}% | H ${p.hunger}% | E ${p.energy}%</div>`).join('') || '<p>Belum ada koleksi</p>'}
  `;
  const selInv=document.getElementById('selInv');
  const selSell=document.getElementById('selSell');
  selInv.innerHTML = me.inventory.map((p,i)=>`<option value="${i}">#${i+1} ‚Äî Lv ${p.level}</option>`).join('');
  selSell.innerHTML = selInv.innerHTML;
}

function setActive(){
  const me=players[currentUser];
  if(me.inventory.length===0) return alert('Koleksi kosong.');
  const idx=parseInt(document.getElementById('selInv').value||'0');
  const pet=me.inventory.splice(idx,1)[0];
  if(me.pet) me.inventory.push(me.pet); // simpan pet aktif lama ke koleksi
  me.pet = pet;
  save(); render(); alert('Pet aktif diperbarui!');
}

function sellPet(){
  const me=players[currentUser];
  if(me.inventory.length===0) return alert('Koleksi kosong.');
  const idx=parseInt(document.getElementById('selSell').value||'0');
  const price=parseInt(document.getElementById('sellPrice').value||'0');
  if(!price || price<=0) return alert('Harga tidak valid.');
  const pet = me.inventory.splice(idx,1)[0];
  const market = JSON.parse(localStorage.getItem('market')||'{}');
  const id = 'sale_'+Date.now();
  market[id] = { seller: currentUser, pet, price };
  localStorage.setItem('market', JSON.stringify(market));
  save(); render(); alert('Pet dimasukkan ke marketplace!');
}

render();
</script>
</body>
</html>
