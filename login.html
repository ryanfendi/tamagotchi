<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login Tamagotchi</title>
<style>
  body {background:#0b1220;color:#fff;font-family:sans-serif;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
  .box {background:#101a2b;padding:20px;border-radius:12px;width:320px;text-align:center}
  input {width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #334155;background:#1e293b;color:#fff}
  button {width:100%;padding:10px;margin:6px 0;background:#10b981;border:0;color:#06261f;font-weight:700;border-radius:10px;cursor:pointer}
  button:hover{transform:scale(1.05)}
  .toggle {color:#60a5fa;cursor:pointer;font-size:14px;margin-top:8px;display:inline-block}
</style>
</head>
<body>
  <div class="box">
    <h2 id="title">Login</h2>
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <input id="username" type="text" placeholder="Username (saat daftar)" style="display:none">
    <button id="actionBtn">Login</button>
    <span class="toggle" onclick="toggleMode()">Belum punya akun? Daftar</span>
    <p id="msg"></p>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAN0GNZdIx_xPHT7MZKWJweLtNhies6QxY",
      authDomain: "tamagotchi-2be0c.firebaseapp.com",
      databaseURL: "https://tamagotchi-2be0c-default-rtdb.firebaseio.com",
      projectId: "tamagotchi-2be0c",
      storageBucket: "tamagotchi-2be0c.firebasestorage.app",
      messagingSenderId: "202052432703",
      appId: "1:202052432703:web:cb76b50e42149a2c92998a",
      measurementId: "G-TWGGSJRX26"
    };
    firebase.initializeApp(firebaseConfig);
    const auth=firebase.auth(), db=firebase.database();

    let isLogin=true;
    function toggleMode(){
      isLogin=!isLogin;
      document.getElementById("title").textContent=isLogin?"Login":"Daftar";
      document.getElementById("actionBtn").textContent=isLogin?"Login":"Daftar";
      document.getElementById("username").style.display=isLogin?"none":"block";
      document.querySelector(".toggle").textContent=isLogin?"Belum punya akun? Daftar":"Sudah punya akun? Login";
    }

    document.getElementById("actionBtn").onclick=async ()=>{
      const email=document.getElementById("email").value;
      const pass=document.getElementById("password").value;
      const uname=document.getElementById("username").value;
      const msg=document.getElementById("msg");
      msg.textContent="⏳...";
      try{
        if(isLogin){
          await auth.signInWithEmailAndPassword(email,pass);
        }else{
          const cred=await auth.createUserWithEmailAndPassword(email,pass);
          await db.ref("users/"+cred.user.uid).set({
            email:email, username:uname||"player", coins:50, level:1, hunger:100, energy:100, hp:100,
            currentPet:0, inventory:[{name:"Chick",level:1,kind:"egg"}], updatedAt:Date.now()
          });
        }
        location.href="game.html";
      }catch(e){ msg.textContent="⚠️ "+e.message; }
    };

    // kalau user sudah login, langsung masuk game
    auth.onAuthStateChanged(u=>{ if(u) location.href="game.html"; });
  </script>
</body>
</html>
