<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tamagotchi Pixel Game</title>
<style>
  body { background:#0b1220; color:#fff; font-family:sans-serif; text-align:center; }
  canvas { background:#08121a; image-rendering:pixelated; border-radius:8px; margin-top:10px; }
  .controls button { background:#10b981; border:none; padding:10px; margin:5px; border-radius:8px; font-weight:bold; cursor:pointer; }
  .hidden { display:none; }
  .bar { width:220px; height:20px; background:#333; border-radius:8px; margin:6px auto; position:relative; overflow:hidden; }
  .fill { height:100%; border-radius:8px; transition:width .25s ease; }
  .hunger { background:#f87171; }
  .energy { background:#60a5fa; }
  .hp { background:#34d399; }
  .menu { margin-top:10px; }
  .menu a, .menu button { display:inline-block; background:#1f2937; color:#fff; text-decoration:none; padding:8px 10px; margin:4px; border-radius:8px; border:0; }
</style>
</head>
<body>
<h1>üê£ Tamagotchi Pixel Game</h1>

<!-- LOGIN -->
<div id="loginBox">
  <input id="playerName" placeholder="Username"/><br/>
  <input id="playerPass" type="password" placeholder="Password"/><br/>
  <button onclick="login()">Login</button>
</div>

<!-- GAME -->
<div id="gameBox" class="hidden">
  <div class="menu">
    <a href="inventory.html">üì¶ Inventory</a>
    <a href="marketplace.html">üè™ Marketplace</a>
    <a href="leaderboard.html">üèÜ Leaderboard</a>
    <a href="chat.html">üí¨ Chat</a>
    <button onclick="logout()">üö™ Logout</button>
  </div>

  <canvas id="gameCanvas" width="128" height="128" style="width:300px;height:300px;"></canvas>
  
  <div id="bars">
    <div class="bar"><div id="barHunger" class="fill hunger"></div></div>
    <div class="bar"><div id="barEnergy" class="fill energy"></div></div>
    <div class="bar"><div id="barHP" class="fill hp"></div></div>
  </div>
  
  <div id="status"></div>
  <div id="coinInfo"></div>
  
  <div class="controls">
    <button onclick="buyFeed()">üçé Feed (100)</button>
    <button onclick="buySleep()">üí§ Sleep (100)</button>
    <button onclick="earnCoin()">üí∞ Tap Coin</button>
    <button onclick="buyPet()">üõí Evolusi/Beli Pet (+1 Level, 1000)</button>
  </div>
</div>

<!-- AUDIO -->
<audio id="sfxFeed" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_40d1f4e5a2.mp3?filename=cartoon-bite-108349.mp3"></audio>
<audio id="sfxSleep" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_838e2fda24.mp3?filename=sleep-1-108351.mp3"></audio>
<audio id="sfxLevel" src="https://cdn.pixabay.com/download/audio/2021/12/22/audio_2a51f75b6f.mp3?filename=game-bonus-144751.mp3"></audio>
<audio id="sfxDead" src="https://cdn.pixabay.com/download/audio/2021/09/20/audio_21f7a9a32f.mp3?filename=sad-trombone-471.mp3"></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

let players = JSON.parse(localStorage.getItem("players")||"{}");
let currentUser = localStorage.getItem("sessionUser") || null;
let animFrame = 0;

function saveAll(){ localStorage.setItem("players", JSON.stringify(players)); }
function playSound(id){ const a=document.getElementById(id); if(a){ a.currentTime=0; a.play(); }}

function ensureUser(){
  if(currentUser && players[currentUser]){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("gameBox").classList.remove("hidden");
    updateUI(); drawPet();
  }
}
ensureUser();

// LOGIN
function login(){
  const name=document.getElementById("playerName").value.trim();
  const pass=document.getElementById("playerPass").value.trim();
  if(!name||!pass) return alert("Isi username & password!");
  if(!players[name]){
    players[name]={password:pass,coins:500,pet:{level:1,hunger:100,energy:100,hp:100},inventory:[]};
  } else {
    if(players[name].password!==pass) return alert("Username/Password salah!");
  }
  currentUser = name;
  localStorage.setItem("sessionUser", name);
  saveAll();
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("gameBox").classList.remove("hidden");
  updateUI(); drawPet();
}

// LOGOUT
function logout(){
  localStorage.removeItem('sessionUser');
  currentUser=null;
  document.getElementById("gameBox").classList.add("hidden");
  document.getElementById("loginBox").classList.remove("hidden");
}

// UPDATE UI
function updateUI(){
  const me = players[currentUser];
  if(!me || !me.pet) return;
  document.getElementById("coinInfo").innerHTML = `üí∞ ${me.coins} | Level ${me.pet.level}`;
  document.getElementById("status").innerHTML = `Hunger: ${me.pet.hunger}% ‚Ä¢ Energy: ${me.pet.energy}% ‚Ä¢ HP: ${me.pet.hp}%`;
  document.getElementById("barHunger").style.width = me.pet.hunger + "%";
  document.getElementById("barEnergy").style.width = me.pet.energy + "%";
  document.getElementById("barHP").style.width = me.pet.hp + "%";
}

// FEED
function buyFeed(){
  const me=players[currentUser];
  if(me.coins<100) return alert("Coin kurang!");
  me.coins-=100;
  me.pet.hunger=Math.min(100,me.pet.hunger+10);
  levelUp(me); saveAll(); updateUI(); playSound("sfxFeed");
}
// SLEEP
function buySleep(){
  const me=players[currentUser];
  if(me.coins<100) return alert("Coin kurang!");
  me.coins-=100;
  me.pet.energy=Math.min(100,me.pet.energy+10);
  levelUp(me); saveAll(); updateUI(); playSound("sfxSleep");
}
// EARN
function earnCoin(){ players[currentUser].coins+=10; saveAll(); updateUI(); }
// BUY PET / EVO
function buyPet(){
  const me=players[currentUser];
  if(me.coins<1000) return alert("Coin kurang!");
  me.coins-=1000;
  me.pet.level++;
  me.pet.hunger=100; me.pet.energy=100; me.pet.hp=100;
  saveAll(); updateUI(); playSound("sfxLevel");
}

// LEVEL UP
function levelUp(me){
  if(me.pet.hunger>=80 && me.pet.energy>=80){
    me.pet.level++;
    playSound("sfxLevel");
  }
}

// TIMER: reduce stats tiap menit
setInterval(()=>{
  if(!currentUser) return;
  const me=players[currentUser]; if(!me || !me.pet) return;
  me.pet.hunger=Math.max(0, me.pet.hunger-1);
  me.pet.energy=Math.max(0, me.pet.energy-1);
  if(me.pet.hunger===0 && me.pet.energy===0){
    me.pet.hp=Math.max(0, me.pet.hp-20);
  }
  if(me.pet.hp<=0){
    alert("üíÄ Pet mati! Kembali ke Level 1");
    playSound("sfxDead");
    me.pet={level:1,hunger:100,energy:100,hp:100};
  }
  saveAll(); updateUI();
}, 60000);

// DRAW PET (pixel simple + warna berubah tiap tier)
function drawPet(){
  if(!currentUser) return requestAnimationFrame(drawPet);
  const me=players[currentUser]; if(!me || !me.pet) return requestAnimationFrame(drawPet);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#08121a"; ctx.fillRect(0,0,canvas.width,canvas.height);
  const lvl=me.pet.level;
  const px = 40 + Math.sin(animFrame/10)*5, py = 60;
  // warna evolusi
  let body = "#ffd07a"; // 1-4
  if(lvl>=5 && lvl<10) body="#a78bfa";
  else if(lvl>=10 && lvl<15) body="#34d399";
  else if(lvl>=15) body="#f59e0b";
  ctx.fillStyle = body; ctx.fillRect(px,py,40,30);
  // mata
  ctx.fillStyle="#111"; ctx.fillRect(px+8,py+8,5,5); ctx.fillRect(px+26,py+8,5,5);
  // detail bentuk
  if(lvl>=5){ ctx.fillStyle="#fff"; ctx.fillRect(px+15,py,10,5);} // "sayap"
  if(lvl>=10){ ctx.fillStyle="#111"; ctx.fillRect(px+18,py+18,4,4);} // "mulut"
  animFrame++;
  requestAnimationFrame(drawPet);
}
</script>
</body>
</html>
