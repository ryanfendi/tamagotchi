<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tamagotchi Game</title>
<style>
  body{background:#0b1220;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:20px}
  canvas{background:#08121a;image-rendering:pixelated;border-radius:8px}
  .controls button, .panel-btn{background:#10b981;border:none;padding:8px;margin:5px;border-radius:8px;color:#fff;font-weight:bold;cursor:pointer}
  #hpBarContainer{width:300px;height:20px;background:#444;margin:10px auto;border-radius:10px;}
  #hpBar{height:100%;background:#10b981;border-radius:10px;}
  #ownerPanel, .transferPanel{background:#222;padding:10px;margin:10px auto;border-radius:8px;max-width:560px;}
</style>
</head>
<body>
<!-- Proteksi -->
<script>
  (function(){
    const current = localStorage.getItem('currentPlayer');
    if(!current){ alert('Silakan login terlebih dahulu'); location.href='login.html'; return; }
    const players = JSON.parse(localStorage.getItem('players')||'{}');
    if(!players[current]){ localStorage.removeItem('currentPlayer'); alert('Akun tidak ditemukan. Login kembali.'); location.href='login.html'; }
  })();
</script>

<h1>üê£ Tamagotchi Game</h1>
<div>
  <button class="panel-btn" onclick="logout()">Logout</button>
  <button class="panel-btn" onclick="goTo('inventory.html')">Inventory</button>
  <button class="panel-btn" onclick="goTo('marketplace.html')">Marketplace</button>
  <button class="panel-btn" onclick="goTo('leaderboard.html')">Leaderboard</button>
  <button class="panel-btn" onclick="goTo('chat.html')">Chat</button>
  <button class="panel-btn" onclick="goTo('owner.html')">Owner</button>
</div>

<canvas id="gameCanvas" width="128" height="128" style="width:300px;height:300px;"></canvas>
<div class="controls">
  <button onclick="feedPet()">Feed</button>
  <button onclick="sleepPet()">Sleep</button>
  <button onclick="earnCoin()">Tap Coin</button>
  <button onclick="buyPet()">Beli Pet</button>
</div>

<div id="status"></div>
<div id="coinInfo"></div>
<div id="hpBarContainer"><div id="hpBar"></div></div>

<div id="ownerPanel" style="display:none;">
  <h3>OWNER PANEL</h3>
  <input id="sendTo" placeholder="Transfer Coin ke (username)">
  <input id="sendAmount" type="number" placeholder="Jumlah Coin">
  <button onclick="transferCoins()">Transfer Coin</button><br><br>
  <input id="tradeTo" placeholder="Transfer Pet ke (username)">
  <input id="tradePetIndex" type="number" placeholder="Index Pet">
  <button onclick="transferPet()">Transfer Pet</button>
</div>

<script>
const players = JSON.parse(localStorage.getItem('players')||'{}');
const current = localStorage.getItem('currentPlayer');
let currentPlayer = players[current];
const OWNER = 'owner';

function saveAll(){ players[current]=currentPlayer; localStorage.setItem('players', JSON.stringify(players)); }
function logout(){ localStorage.removeItem('currentPlayer'); location.href='login.html'; }
function goTo(p){location.href=p;}

if(currentPlayer.username === OWNER) document.getElementById('ownerPanel').style.display = 'block';

function updateUI(){
  const hp = currentPlayer.pet.health;
  const max = currentPlayer.pet.maxHealth;
  const pct = Math.max(0, Math.min(100, (hp/max)*100));
  document.getElementById('coinInfo').textContent = `Coin: ${currentPlayer.coins} | Level: ${currentPlayer.pet.level}`;
  document.getElementById('status').textContent = `Status: ${currentPlayer.pet.alive?'Hidup':'Mati'} | HP: ${hp}/${max}`;
  const bar = document.getElementById('hpBar');
  bar.style.width = pct + '%';
  bar.style.background = pct>50 ? '#10b981' : pct>20 ? '#f59e0b' : '#ef4444';
}

function transferCoins(){
  const to = (document.getElementById('sendTo').value||'').trim().toLowerCase();
  const amt = parseInt((document.getElementById('sendAmount').value||'').toString(),10);
  if(!players[to]) return alert('Player tidak ditemukan');
  if(currentPlayer.coins < amt) return alert('Coin tidak cukup');
  currentPlayer.coins -= amt; players[to].coins = (players[to].coins||0) + amt;
  saveAll(); updateUI(); alert(`Berhasil transfer ${amt} coin ke ${to}`);
}

function transferPet(){
  const to = (document.getElementById('tradeTo').value||'').trim().toLowerCase();
  const idx = parseInt((document.getElementById('tradePetIndex').value||'').toString(),10);
  if(!players[to]) return alert('Player tidak ditemukan');
  if(currentPlayer.inventory.length<=idx || idx<0) return alert('Index pet tidak valid');
  const pet = currentPlayer.inventory.splice(idx,1)[0];
  players[to].inventory = players[to].inventory||[];
  players[to].inventory.push(pet);
  saveAll(); alert(`Pet ${pet.name} ditransfer ke ${to}`);
}

// Pet logic (feedPet, etc.)... similar to sebelumnya, plus updateUI()

updateUI();
</script>
</body>
</html>
