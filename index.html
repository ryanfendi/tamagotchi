<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tamagotchi Pixel Game</title>
<style>
  body { background:#0b1220; color:#fff; font-family:sans-serif; text-align:center; }
  canvas { background:#08121a; image-rendering:pixelated; border-radius:8px; margin-top:10px; }
  .controls button { background:#10b981; border:none; padding:10px; margin:5px; border-radius:8px; font-weight:bold; cursor:pointer; }
  .hidden { display:none; }
  .bar { width:200px; height:20px; background:#333; border-radius:8px; margin:5px auto; position:relative; }
  .fill { height:100%; border-radius:8px; }
  .hunger { background:#f87171; }
  .energy { background:#60a5fa; }
  .hp { background:#34d399; }
</style>
</head>
<body>
<h1>ğŸ£ Tamagotchi Pixel Game</h1>

<!-- LOGIN -->
<div id="loginBox">
  <input id="playerName" placeholder="Username"><br>
  <input id="playerPass" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
</div>

<!-- GAME -->
<div id="gameBox" class="hidden">
  <canvas id="gameCanvas" width="128" height="128" style="width:300px;height:300px;"></canvas>
  
  <div id="bars">
    <div class="bar"><div id="barHunger" class="fill hunger"></div></div>
    <div class="bar"><div id="barEnergy" class="fill energy"></div></div>
    <div class="bar"><div id="barHP" class="fill hp"></div></div>
  </div>
  
  <div id="status"></div>
  <div id="coinInfo"></div>
  
  <div class="controls">
    <button onclick="buyFeed()">ğŸ Feed (100)</button>
    <button onclick="buySleep()">ğŸ’¤ Sleep (100)</button>
    <button onclick="earnCoin()">ğŸ’° Tap Coin</button>
    <button onclick="buyPet()">ğŸ›’ Pet Baru</button>
    <button onclick="goTo('inventory.html')">ğŸ“¦ Inventory</button>
    <button onclick="goTo('marketplace.html')">ğŸª Marketplace</button>
    <button onclick="goTo('leaderboard.html')">ğŸ† Leaderboard</button>
    <button onclick="goTo('chat.html')">ğŸ’¬ Chat</button>
    <button onclick="logout()">ğŸšª Logout</button>
  </div>
</div>

<!-- AUDIO -->
<audio id="sfxFeed" src="https://cdn.pixabay.com/download/audio/2021/09/20/audio_a7c.mp3"></audio>
<audio id="sfxSleep" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_zzzz.mp3"></audio>
<audio id="sfxLevel" src="https://cdn.pixabay.com/download/audio/2021/09/15/audio_ding.mp3"></audio>
<audio id="sfxDead" src="https://cdn.pixabay.com/download/audio/2022/01/09/audio_sad.mp3"></audio>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
ctx.imageSmoothingEnabled=false;

let players=JSON.parse(localStorage.getItem("players")||"{}");
let currentUser=null;
let animFrame=0;

function saveAll(){ localStorage.setItem("players", JSON.stringify(players)); }
function playSound(id){ let a=document.getElementById(id); if(a){a.currentTime=0; a.play();} }

// LOGIN
function login(){
  const name=document.getElementById("playerName").value.trim();
  const pass=document.getElementById("playerPass").value.trim();
  if(!name||!pass) return alert("Isi username & password!");
  if(!players[name]){
    players[name]={password:pass,coins:500,pet:{level:1,hunger:100,energy:100,hp:100},inventory:[]};
  } else {
    if(players[name].password!==pass) return alert("Password salah!");
  }
  currentUser=name; saveAll();
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("gameBox").classList.remove("hidden");
  updateUI(); drawPet();
}

// LOGOUT
function logout(){
  currentUser=null;
  document.getElementById("gameBox").classList.add("hidden");
  document.getElementById("loginBox").classList.remove("hidden");
}

// UPDATE UI
function updateUI(){
  let me=players[currentUser]; if(!me||!me.pet) return;
  document.getElementById("coinInfo").innerHTML=`ğŸ’° ${me.coins} | Level ${me.pet.level}`;
  document.getElementById("status").innerHTML=`Hunger:${me.pet.hunger}% Energy:${me.pet.energy}% HP:${me.pet.hp}%`;
  document.getElementById("barHunger").style.width=me.pet.hunger+"%";
  document.getElementById("barEnergy").style.width=me.pet.energy+"%";
  document.getElementById("barHP").style.width=me.pet.hp+"%";
}

// FEED
function buyFeed(){
  let me=players[currentUser];
  if(me.coins<100) return alert("Coin kurang!");
  me.coins-=100;
  me.pet.hunger=Math.min(100,me.pet.hunger+10);
  levelUp(me); saveAll(); updateUI(); playSound("sfxFeed");
}
// SLEEP
function buySleep(){
  let me=players[currentUser];
  if(me.coins<100) return alert("Coin kurang!");
  me.coins-=100;
  me.pet.energy=Math.min(100,me.pet.energy+10);
  levelUp(me); saveAll(); updateUI(); playSound("sfxSleep");
}
// EARN
function earnCoin(){ players[currentUser].coins+=10; saveAll(); updateUI(); }
// BUY PET
function buyPet(){
  let me=players[currentUser];
  if(me.coins<1000) return alert("Coin kurang!");
  me.coins-=1000; me.pet.level++; me.pet.hunger=100; me.pet.energy=100; me.pet.hp=100;
  saveAll(); updateUI(); playSound("sfxLevel");
}

// LEVEL UP
function levelUp(me){
  if(me.pet.hunger>=80&&me.pet.energy>=80){ me.pet.level++; playSound("sfxLevel"); }
}

// TIMER: reduce stats
setInterval(()=>{
  if(!currentUser) return;
  let me=players[currentUser]; if(!me.pet) return;
  me.pet.hunger=Math.max(0,me.pet.hunger-1);
  me.pet.energy=Math.max(0,me.pet.energy-1);
  if(me.pet.hunger===0&&me.pet.energy===0){ me.pet.hp=Math.max(0,me.pet.hp-20); }
  if(me.pet.hp<=0){ alert("ğŸ’€ Pet mati! Balik Level 1"); playSound("sfxDead"); me.pet={level:1,hunger:100,energy:100,hp:100}; }
  saveAll(); updateUI();
},60000);

// DRAW PET
function drawPet(){
  if(!currentUser) return requestAnimationFrame(drawPet);
  let me=players[currentUser]; if(!me.pet) return requestAnimationFrame(drawPet);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#08121a"; ctx.fillRect(0,0,canvas.width,canvas.height);
  let lvl=me.pet.level;
  let px=40+Math.sin(animFrame/10)*5; let py=60;
  ctx.fillStyle=lvl<3?"#ffd07a":lvl<6?"#a78bfa":"#34d399";
  ctx.fillRect(px,py,40,30);
  ctx.fillStyle="#111"; ctx.fillRect(px+8,py+8,5,5); ctx.fillRect(px+26,py+8,5,5);
  if(lvl>=5){ctx.fillStyle="#fff"; ctx.fillRect(px+15,py,10,5);} // sayap di level tinggi
  animFrame++;
  requestAnimationFrame(drawPet);
}

function goTo(p){ window.location=p; }
</script>
</body>
</html>
