<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tamagotchi Pixel ‚Äî Game</title>
<style>
  body {margin:0;background:#071726;color:#fff;font-family:sans-serif;text-align:center;}
  h1 {margin:10px 0;}
  canvas {background:#0b1220;margin:10px auto;display:block;image-rendering:pixelated;}
  .btn {background:#10b981;color:#042018;border:0;padding:10px;margin:5px;border-radius:8px;font-weight:bold;cursor:pointer;}
  .btn.alt {background:#06b6d4;}
  .stats {margin-top:10px;}
  .link-nav {margin:10px;display:flex;justify-content:center;gap:8px;}
  .link-nav a {color:#10b981;text-decoration:none;font-weight:bold;}
</style>
</head>
<body>
<h1>üê£ Tamagotchi Pixel</h1>
<canvas id="canvas" width="128" height="128" style="width:256px;height:256px"></canvas>
<div>
  <button class="btn" id="feedBtn">üçé Feed (500 coins)</button>
  <button class="btn alt" id="sleepBtn">üí§ Sleep</button>
</div>
<div style="margin-top:8px;">
  <button class="btn" id="tapBtn">üëÜ Tap for Coins (+1)</button>
  <button class="btn alt" id="topupBtn">üí≥ Top-Up Coins</button>
</div>
<div class="stats">
  Coins: <span id="coinsText">0</span> | HP: <span id="hpText">1000</span> | Status: <span id="statusText">Hidup</span>
</div>
<div class="link-nav">
  <a href="inventory.html">üì¶ Inventory</a>
  <a href="marketplace.html">üõí Marketplace</a>
</div>
<script>
const CANVAS = document.getElementById('canvas');
const CTX = CANVAS.getContext('2d');
CTX.imageSmoothingEnabled = false;

// UI refs
const feedBtn = document.getElementById('feedBtn');
const sleepBtn = document.getElementById('sleepBtn');
const tapBtn = document.getElementById('tapBtn');
const topupBtn = document.getElementById('topupBtn');
const coinsText = document.getElementById('coinsText');
const hpText = document.getElementById('hpText');
const statusText = document.getElementById('statusText');

// Storage Keys
const PLAYER_KEY = 'tama_player_v3';

// Load Player
function loadPlayer(){
  try { return JSON.parse(localStorage.getItem(PLAYER_KEY)) || null; } catch(e){ return null; }
}
function savePlayer(obj){
  localStorage.setItem(PLAYER_KEY, JSON.stringify(obj));
}

// Create default player
function defaultPlayer(){
  return {
    coins: 0,
    hp: 1000,
    feedCountToday: 0,
    lastFeed: null,
    lastDay: localDateStr(Date.now()),
    activePet: { evo:0, alive:true },
  };
}

let player = loadPlayer() || defaultPlayer();
savePlayer(player);

function localDateStr(ts){
  const d = new Date(ts);
  return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate();
}

// Update UI
function updateUI(){
  coinsText.textContent = player.coins;
  hpText.textContent = player.hp;
  statusText.textContent = player.activePet.alive ? "Hidup" : "Mati";
}

// Check daily
function checkDaily(){
  const today = localDateStr(Date.now());
  if(player.lastDay !== today){
    // Cek feed count kemarin
    if(player.feedCountToday < 3){
      player.hp -= 200; // kurang HP kalau ga makan cukup
    } else {
      player.hp += 50; // bonus kalau makan cukup
      if(player.hp > 1000) player.hp = 1000;
    }
    if(player.hp <= 0){
      player.activePet.alive = false;
    }
    player.feedCountToday = 0;
    player.lastDay = today;
    savePlayer(player);
  }
}

// Animasi pet (pixel style)
function drawPet(){
  CTX.fillStyle = '#08121a'; CTX.fillRect(0,0,CANVAS.width,CANVAS.height);
  if(!player.activePet.alive){
    CTX.fillStyle = 'red';
    CTX.font = '10px monospace';
    CTX.fillText('PET MATI', 20, 64);
    return;
  }
  // Pet shape
  CTX.fillStyle = '#ffd07a';
  CTX.fillRect(44,44,40,40);
  CTX.fillStyle = '#111';
  CTX.fillRect(52,54,6,6);
  CTX.fillRect(66,54,6,6);
  CTX.fillStyle = '#ffb4a2';
  CTX.fillRect(58,66,10,4);
}

setInterval(()=>{
  checkDaily();
  updateUI();
  drawPet();
},1000);

// Buttons
feedBtn.addEventListener('click', ()=>{
  if(!player.activePet.alive) return alert('Pet mati!');
  if(player.coins < 500) return alert('Coin kurang! Butuh 500.');
  player.coins -= 500;
  player.feedCountToday += 1;
  player.lastFeed = Date.now();
  savePlayer(player);
  updateUI();
});

sleepBtn.addEventListener('click', ()=>{
  alert('Pet tidur sebentar...');
});

tapBtn.addEventListener('click', ()=>{
  player.coins += 1;
  savePlayer(player);
  updateUI();
});

topupBtn.addEventListener('click', ()=>{
  player.coins += 1000;
  savePlayer(player);
  updateUI();
});

updateUI();
drawPet();
</script>
</body>
</html>
