<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tamagotchi Online</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f2f2f2; text-align:center; }
    .card { background:#fff; padding:20px; margin:20px auto; border-radius:10px; width:300px; box-shadow:0 2px 8px rgba(0,0,0,0.2); }
    input, button { width:90%; padding:10px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
    button { background:#4CAF50; color:white; border:none; cursor:pointer; }
    button:hover { background:#45a049; }
  </style>
</head>
<body>

  <h1>üê∂ Tamagotchi Online</h1>

  <!-- Register -->
  <div class="card">
    <h2>Daftar</h2>
    <input id="regEmail" type="email" placeholder="Email"><br>
    <input id="regUser" type="text" placeholder="Username"><br>
    <input id="regPass" type="password" placeholder="Password"><br>
    <button type="button" onclick="register()">Daftar</button>
  </div>

  <!-- Login -->
  <div class="card">
    <h2>Login</h2>
    <input id="loginUser" type="text" placeholder="Email atau Username"><br>
    <input id="loginPass" type="password" placeholder="Password"><br>
    <button type="button" onclick="login()">Login</button>
  </div>

  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } 
      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getDatabase, ref, set, get, query, orderByChild, equalTo } 
      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // ‚úÖ Firebase Config kamu
    const firebaseConfig = {
      apiKey: "AIzaSyAN0GNZdIx_xPHT7MZKWJweLtNhies6QxY",
      authDomain: "tamagotchi-2be0c.firebaseapp.com",
      databaseURL: "https://tamagotchi-2be0c-default-rtdb.firebaseio.com",
      projectId: "tamagotchi-2be0c",
      storageBucket: "tamagotchi-2be0c.firebasestorage.app",
      messagingSenderId: "202052432703",
      appId: "1:202052432703:web:cb76b50e42149a2c92998a",
      measurementId: "G-TWGGSJRX26"
    };

    // Inisialisasi Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // ‚úÖ Daftar akun baru
    window.register = async function() {
      const email = document.getElementById("regEmail").value.trim();
      const user = document.getElementById("regUser").value.trim();
      const pass = document.getElementById("regPass").value;

      if (!email || !user || !pass) {
        alert("Lengkapi semua field!");
        return;
      }

      try {
        // cek username unik
        let snap = await get(query(ref(db, "users"), orderByChild("username"), equalTo(user)));
        if (snap.exists()) {
          alert("‚ö†Ô∏è Username sudah dipakai, silakan pilih lain.");
          return;
        }

        let cred = await createUserWithEmailAndPassword(auth, email, pass);
        await set(ref(db, "users/" + cred.user.uid), {
          email: email,
          username: user,
          coin: 0,
          level: 1,
          pets: []
        });

        alert("‚úÖ Akun berhasil dibuat! Silakan login.");
      } catch (err) {
        alert("‚ùå Gagal daftar: " + err.message);
      }
    }

    // ‚úÖ Login dengan Email atau Username
    window.login = async function() {
      const user = document.getElementById("loginUser").value.trim();
      const pass = document.getElementById("loginPass").value;

      if (!user || !pass) {
        alert("Isi username/email dan password!");
        return;
      }

      try {
        if (user.includes("@")) {
          // login pakai email
          await signInWithEmailAndPassword(auth, user, pass);
        } else {
          // login pakai username ‚Üí cari email
          let snap = await get(query(ref(db, "users"), orderByChild("username"), equalTo(user)));
          if (snap.exists()) {
            let email = Object.values(snap.val())[0].email;
            await signInWithEmailAndPassword(auth, email, pass);
          } else {
            alert("Username tidak ditemukan!");
            return;
          }
        }
        alert("‚úÖ Login berhasil!");
        localStorage.setItem("login", "true");
        localStorage.setItem("username", user);
        window.location.href = "inventory.html"; // masuk game
      } catch (err) {
        alert("‚ùå Login gagal: " + err.message);
      }
    }
  </script>

</body>
</html>
