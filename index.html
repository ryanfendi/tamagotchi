<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tamagotchi Pixel Game</title>
<style>
  body { background:#0b1220; color:#fff; font-family:sans-serif; text-align:center; }
  canvas { background:#08121a; image-rendering:pixelated; border-radius:8px; margin:10px auto; display:block; }
  .controls button { background:#10b981; border:none; padding:10px; margin:5px; border-radius:8px; font-weight:bold; cursor:pointer; }
  .hidden { display:none; }
</style>
</head>
<body>
<h1>üê£ Tamagotchi Pixel Game</h1>

<!-- Login Panel -->
<div id="loginPanel">
  <input id="username" type="text" placeholder="Username"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
</div>

<!-- Game Panel -->
<div id="gamePanel" class="hidden">
  <p>üë§ <span id="playerName"></span> | <button onclick="logout()">Logout</button></p>
  <canvas id="gameCanvas" width="128" height="128" style="width:300px;height:300px;"></canvas>
  
  <div id="status"></div>
  <div id="coinInfo"></div>
  <div id="bars"></div>

  <div class="controls">
    <button onclick="feedPet()">üçé Feed (500 coin)</button>
    <button onclick="sleepPet()">üí§ Sleep (500 coin)</button>
    <button onclick="earnCoin()">üí∞ Tap Coin</button>
    <button onclick="buyPet()">üõí Evolusi Pet</button>
    <button onclick="levelUpManual()">‚¨ÜÔ∏è Naik Level (100000 coin)</button>
  </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

let players = JSON.parse(localStorage.getItem("players")||"{}");
let currentUser = localStorage.getItem("lastUser")||null;
let me = null;

// Login
function login(){
  const name = document.getElementById("username").value.trim();
  const pass = document.getElementById("password").value.trim();
  if(!name||!pass) return alert("Isi username & password!");

  if(!players[name]){ // register baru
    players[name] = {
      username:name, password:pass,
      coins:1000,
      pet:{level:1,hp:100,hunger:100,energy:100,alive:true},
      inventory:{feed:0,sleep:0}
    };
  } else {
    if(players[name].password!==pass) return alert("Password salah!");
  }
  me = players[name];
  currentUser = name;
  localStorage.setItem("lastUser",name);
  save();
  showGame();
}
function logout(){
  localStorage.removeItem("lastUser");
  location.reload();
}

// Show UI
function showGame(){
  document.getElementById("loginPanel").classList.add("hidden");
  document.getElementById("gamePanel").classList.remove("hidden");
  document.getElementById("playerName").innerText = me.username;
  updateUI();
  drawPet();
}

// Save
function save(){ localStorage.setItem("players",JSON.stringify(players)); }

// UI Update
function updateUI(){
  document.getElementById("coinInfo").innerHTML = `üí∞ Coin: ${me.coins} | Level: ${me.pet.level}`;
  document.getElementById("status").innerHTML = `Status: ${me.pet.alive?"Hidup":"Mati"} | HP: ${me.pet.hp}`;
  document.getElementById("bars").innerHTML = 
    `Hunger: ${me.pet.hunger}% | Energy: ${me.pet.energy}%`;
}

// Feed
function feedPet(){
  if(!me.pet.alive) return alert("Pet sudah mati!");
  if(me.coins<500) return alert("Coin tidak cukup!");
  me.coins-=500;
  me.pet.hunger=Math.min(100,me.pet.hunger+10);
  updateUI(); save();
}
// Sleep
function sleepPet(){
  if(!me.pet.alive) return alert("Pet sudah mati!");
  if(me.coins<500) return alert("Coin tidak cukup!");
  me.coins-=500;
  me.pet.energy=Math.min(100,me.pet.energy+10);
  updateUI(); save();
}
// Earn coin
function earnCoin(){ me.coins+=10; updateUI(); save(); }
// Buy/Evolusi Pet
function buyPet(){
  const price=me.pet.level*10000;
  if(me.coins<price) return alert("Coin tidak cukup!");
  me.coins-=price;
  me.pet.level++;
  updateUI(); save();
}
// Level up manual
function levelUpManual(){
  if(me.coins<100000) return alert("Coin tidak cukup!");
  me.coins-=100000;
  me.pet.level++;
  updateUI(); save();
}

// Sprite lucu unik tiap level (canvas pixel art)
function drawPet(){
  if(!me||!me.pet) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  let lvl=me.pet.level;
  ctx.fillStyle="#08121a"; ctx.fillRect(0,0,128,128);

  if(lvl<5){ // bayi
    ctx.fillStyle="#ffd07a";
    ctx.fillRect(50,60,30,25);
    ctx.fillStyle="#000"; ctx.fillRect(58,70,5,5); ctx.fillRect(68,70,5,5);
  } else if(lvl<10){ // anak
    ctx.fillStyle="#88f";
    ctx.beginPath(); ctx.arc(64,70,20,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="#fff"; ctx.fillRect(55,65,5,5); ctx.fillRect(70,65,5,5);
  } else if(lvl<20){ // remaja
    ctx.fillStyle="#0f0";
    ctx.fillRect(44,50,40,40);
    ctx.fillStyle="#000"; ctx.fillRect(52,60,5,5); ctx.fillRect(68,60,5,5);
  } else if(lvl<50){ // dewasa
    ctx.fillStyle="#f0f";
    ctx.beginPath(); ctx.arc(64,64,30,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="#fff"; ctx.fillRect(55,55,6,6); ctx.fillRect(72,55,6,6);
  } else { // legendaris
    ctx.fillStyle="#ff0";
    ctx.beginPath(); ctx.moveTo(64,34); ctx.lineTo(94,94); ctx.lineTo(34,94); ctx.closePath(); ctx.fill();
    ctx.fillStyle="#000"; ctx.fillRect(55,70,6,6); ctx.fillRect(70,70,6,6);
  }

  requestAnimationFrame(drawPet);
}

// Timer: kurangi hunger/energy tiap menit
setInterval(()=>{
  if(me&&me.pet&&me.pet.alive){
    me.pet.hunger=Math.max(0,me.pet.hunger-1);
    me.pet.energy=Math.max(0,me.pet.energy-1);
    if(me.pet.hunger===0||me.pet.energy===0){
      me.pet.hp=Math.max(0,me.pet.hp-20);
    }
    if(me.pet.hp<=0){
      me.pet.alive=false;
      me.pet={level:1,hp:100,hunger:100,energy:100,alive:true}; // reset
      alert("‚ò†Ô∏è Pet mati! Mulai dari level 1 lagi");
    }
    updateUI(); save();
  }
},60000); // tiap 1 menit

// Auto login jika sudah
if(currentUser&&players[currentUser]){
  me=players[currentUser];
  showGame();
}
</script>
</body>
</html>
