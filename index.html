<!DOCTYPE html><html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tamagotchi Pixel + Marketplace Offline</title>
<style>
  :root{
    --bg:#0b1220; --card:#0f1724; --accent:#10b981; --muted:#9fb3b5;
  }
  body{
    margin:0; font-family:system-ui; color:#e6eef6;
    background:linear-gradient(180deg,#071726,#06202a);
  }
  .wrap{max-width:960px;margin:20px auto;display:grid;grid-template-columns:480px 1fr;gap:16px;padding:12px}
  .panel{background:#0f1724;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.05)}
  canvas{display:block;margin:12px auto;background:#08121a;border-radius:8px;image-rendering:pixelated}
  h1{margin-top:0;font-size:18px}
  button{background:var(--accent);border:0;padding:6px 10px;border-radius:6px;font-weight:bold;cursor:pointer;color:#042018}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .small{font-size:13px;color:var(--muted)}
  .market-item{border-bottom:1px solid rgba(255,255,255,0.1);padding:6px 0}
  input[type=text]{padding:6px;border-radius:6px;border:0;width:120px}
  @media(max-width:900px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <h1>üê£ Tamagotchi Pixel</h1>
    <canvas id="canvas" width="128" height="128" style="width:256px;height:256px"></canvas>
    <div class="controls">
      <input id="nameInput" type="text" placeholder="Nama player" />
      <button id="startBtn">Login</button>
    </div>
    <div class="controls">
      <button id="feedBtn">üçé Feed</button>
      <button id="sleepBtn">üí§ Sleep</button>
      <button id="sellBtn">üí± Jual</button>
    </div>
    <div style="margin-top:8px" class="small">
      Status: <span id="statusText">-</span> | Coin: <span id="coinText">0</span>
    </div>
    <div style="margin-top:6px" class="small">
      Inventory: <span id="invText">-</span>
    </div>
    <div id="log" class="small" style="margin-top:10px;min-height:30px"></div>
  </div>
  <div class="panel">
    <h2 style="margin-top:0">Marketplace</h2>
    <div style="display:flex;gap:6px;margin-bottom:8px">
      <input id="saleId" type="text" placeholder="id unik" />
      <input id="salePrice" type="text" placeholder="harga" />
      <button id="postSaleBtn">Post Jual</button>
    </div>
    <div style="display:flex;gap:6px;margin-bottom:8px">
      <input id="buyId" type="text" placeholder="id beli" />
      <button id="doBuyBtn">Beli</button>
    </div>
    <div id="marketList" style="max-height:260px;overflow:auto;font-size:14px"></div>
  </div>
</div>
<script>
const CANVAS=document.getElementById('canvas');
const CTX=CANVAS.getContext('2d');
CTX.imageSmoothingEnabled=false;const nameInput=document.getElementById('nameInput'); const startBtn=document.getElementById('startBtn'); const feedBtn=document.getElementById('feedBtn'); const sleepBtn=document.getElementById('sleepBtn'); const sellBtn=document.getElementById('sellBtn'); const logEl=document.getElementById('log'); const statusText=document.getElementById('statusText'); const coinText=document.getElementById('coinText'); const invText=document.getElementById('invText'); const postSaleBtn=document.getElementById('postSaleBtn'); const saleIdInput=document.getElementById('saleId'); const salePriceInput=document.getElementById('salePrice'); const buyIdInput=document.getElementById('buyId'); const doBuyBtn=document.getElementById('doBuyBtn'); const marketListEl=document.getElementById('marketList');

const PLAYERS_KEY='tama_players_v3'; const MARKET_KEY='tama_market_v3';

let players=load(PLAYERS_KEY)||{}; let market=load(MARKET_KEY)||{}; let current=null; let anim={frame:0,mode:'idle',t:0};

function load(k){try{return JSON.parse(localStorage.getItem(k)||'{}')}catch(e){return{}}} function save(k,v){try{localStorage.setItem(k,JSON.stringify(v))}catch(e){}}

function makePlayer(name){return{name,coin:100,inv:{apple:3},pet:{alive:true,mood:'idle',age:0}}}

startBtn.onclick=()=>{ const n=nameInput.value.trim(); if(!n)return alert('Masukkan nama'); if(!players[n])players[n]=makePlayer(n); current=players[n]; log('Login: '+n); render(); tickLoop(); }

feedBtn.onclick=()=>{ if(!current)return alert('Login'); if(!current.pet.alive)return alert('Pet mati'); if((current.inv.apple||0)<=0)return alert('Tidak ada apel'); current.inv.apple--; current.pet.mood='happy'; anim.mode='jump';anim.t=0; log('Pet diberi makan'); saveAll();render(); }

sleepBtn.onclick=()=>{ if(!current)return; current.pet.mood='sleep'; anim.mode='sleep';anim.t=0; saveAll();render(); }

sellBtn.onclick=()=>{ if(!current||!current.pet)return; if(!current.pet.alive)return alert('Tidak bisa jual pet mati'); const id=prompt('Masukkan id unik jualan:'); if(!id)return; const price=parseInt(prompt('Harga?'),10)||10; market[id]={id,seller:current.name,price,pet:JSON.parse(JSON.stringify(current.pet))}; current.pet=null; saveAll();render(); }

postSaleBtn.onclick=()=>{ if(!current||!current.pet)return alert('Login + punya pet'); const id=saleIdInput.value.trim();const price=parseInt(salePriceInput.value)||10; if(!id)return; market[id]={id,seller:current.name,price,pet:JSON.parse(JSON.stringify(current.pet))}; current.pet=null; saveAll();render(); }

doBuyBtn.onclick=()=>{ const id=buyIdInput.value.trim();if(!id)return; const item=market[id];if(!item)return alert('Tidak ditemukan'); if(!current)return alert('Login'); if(current.coin<item.price)return alert('Coin tidak cukup'); current.coin-=item.price; current.pet=item.pet; delete market[id]; saveAll();render(); }

function saveAll(){players[current.name]=current;save(PLAYERS_KEY,players);save(MARKET_KEY,market)}

function log(m){logEl.innerHTML='['+new Date().toLocaleTimeString()+'] '+m+'<br>'+logEl.innerHTML}

function render(){ if(current){statusText.innerText=current.pet?(current.pet.alive?'Hidup':'Mati'):'No Pet'; coinText.innerText=current.coin; invText.innerText='Apel:'+(current.inv.apple||0); } draw();buildMarket(); }

function buildMarket(){marketListEl.innerHTML=''; const keys=Object.keys(market); if(keys.length===0){marketListEl.innerHTML='<div>Marketplace kosong</div>';return;} keys.forEach(id=>{ const it=market[id]; const div=document.createElement('div'); div.className='market-item'; div.innerHTML=<strong>${id}</strong> - Seller:${it.seller} | Harga:${it.price}; marketListEl.appendChild(div); }) }

function tickLoop(){setInterval(()=>{ if(!current||!current.pet)return; anim.frame=(anim.frame+1)%60; if(anim.mode==='jump'){anim.t++;if(anim.t>20){anim.mode='idle';}} if(anim.mode==='sleep'){anim.t++;if(anim.t>40){anim.mode='idle';}} if(anim.mode==='idle'&&Math.random()<0.01){current.pet.mood='blink';anim.t=0;} render(); },500)}

const FACE={ idle:["..xxxx..",".xxxxxx.","xx....xx","xx.xx.xx","xx....xx",".xxxxxx.","..xxxx.."], happy:["..xxxx..",".xxxxxx.","xx ^  xx","xx    xx","xx -- xx",".xxxxxx.","..xxxx.."], sad:["..xxxx..",".xxxxxx.","xx    xx","xx -- xx","xx vv xx",".xxxxxx.","..xxxx.."], angry:["..xxxx..",".xxxxxx.","xx >< xx","xx    xx","xx -- xx",".xxxxxx.","..xxxx.."], sleep:["..xxxx..",".xxxxxx.","xx zz xx","xx zz xx","xx    xx",".xxxxxx.","..xxxx.."], blink:["..xxxx..",".xxxxxx.","xx -- xx","xx    xx","xx -- xx",".xxxxxx.","..xxxx.."] };

function draw(){CTX.clearRect(0,0,128,128);CTX.fillStyle='#08121a';CTX.fillRect(0,0,128,128); if(!current||!current.pet){CTX.fillStyle='#999';CTX.fillText('Login',40,64);return;} let mood=current.pet.mood||'idle';if(!FACE[mood])mood='idle'; const px=32+(Math.sin(anim.frame/10)8); const py=32; FACE[mood].forEach((row,y)=>{[...row].forEach((c,x)=>{ if(c==='x'){CTX.fillStyle='#ffdd7a';CTX.fillRect(px+x4,py+y4,4,4);} if(c==='^'||c==='v'||c==='<'||c==='>'||c==='z'||c==='-'){CTX.fillStyle='#000';CTX.fillRect(px+x4,py+y*4,4,4);} })}); }

draw(); </script>

</body>
</html>
